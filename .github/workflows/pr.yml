name: PR checks

on: 
  workflow_dispatch:
  pull_request:
    branches:
        - develop
        - stage
        - main
    types: [opened, synchronize, reopened]
    paths-ignore:
      - '.github/**/*' 
      - 'sonar-project.properties'

jobs:
    compliance:
        name: PR Compliance check
        runs-on: [self-hosted,Linux,cicdframework]
        steps:
            - name: Checkout code
              uses: actions/checkout@v3
              with:
                fetch-depth: 0
            - name: Set up Node.js 20.x
              uses: actions/setup-node@v4
              with:
                node-version: 20.x
            
            - name: Install dependencies
              run: npm install
              
            - name: Run the tests and generate coverage report
              run: npm test    

            - uses: ./.github/actions/sonarqube_scan
              name: Sonarqube-scan
              with:
                SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
                SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

            - name: Build UI code
              run: npm run build